# This file is automatically generated by `./configs/benchmarks/point_cloud_registration/gen.py`.
# Please do not attempt to modify manually.
from torch.optim.adam import Adam
from torch.optim.lr_scheduler import StepLR
from criteria.vision_3d.point_cloud_registration.geotransformer_criterion.geotransformer_criterion import GeoTransformerCriterion
from data.dataloaders.geotransformer_dataloader import GeoTransformerDataloader
from data.datasets.pcr_datasets.single_temporal_pcr_dataset import SingleTemporalPCRDataset
from data.transforms.compose import Compose
from data.transforms.vision_3d.clamp import Clamp
from metrics.vision_3d.point_cloud_registration.geotransformer_metric.geotransformer_metric import GeoTransformerMetric
from models.point_cloud_registration.geotransformer.geotransformer import GeoTransformer
from optimizers.single_task_optimizer import SingleTaskOptimizer
from runners.supervised_single_task_trainer import SupervisedSingleTaskTrainer


config = {
    'runner': SupervisedSingleTaskTrainer,
    'work_dir': './logs/benchmarks/point_cloud_registration/single_temporal_pcr_0.4/GeoTransformer_run_0',
    'epochs': 100,
    'init_seed': 828681,
    'train_seeds': [22377011, 46670588, 4403292, 32442582, 14348699, 73763176, 74652159, 97411263, 52829112, 89921500, 73162372, 60257038, 72863609, 96300823, 81008210, 37473038, 89273988, 9752408, 88125766, 31992072, 38346761, 76677673, 41912658, 42940866, 68928598, 17189933, 54872225, 73098733, 92238654, 58959974, 79626959, 82320029, 28728174, 93740495, 81930275, 54054497, 79708412, 95484132, 75322721, 97944085, 13650018, 99424575, 77624213, 4897738, 65817144, 80273854, 92951236, 65065929, 63557394, 55920124, 80011799, 20632972, 65034768, 11411178, 74286441, 18667787, 4369817, 16124040, 8967114, 39099400, 66972950, 12070877, 92493833, 95017624, 55948214, 21818108, 86800306, 39194388, 30082131, 58956405, 37518331, 74428152, 12775193, 72777969, 11382704, 81101953, 27213456, 65895028, 11257109, 39753158, 31018841, 66067178, 93911806, 96021651, 1278341, 30327567, 64074099, 38213677, 20482366, 49660614, 92330706, 71244082, 81823715, 52452108, 6871373, 54166026, 68645861, 89200237, 2084995, 26398252],
    'val_seeds': [23480282, 18810120, 87992632, 47039971, 29340920, 53010245, 81855348, 89731446, 78120364, 33187425, 42927659, 98776145, 99172272, 99637801, 1240312, 39989730, 72520926, 74840180, 45822793, 57691474, 57074003, 30725699, 93814717, 6603783, 59882275, 74350638, 65710167, 41352994, 35127588, 32263675, 87928184, 38152888, 85527951, 28450332, 8534255, 11606912, 11459450, 36149336, 80810005, 65425150, 14697488, 44017857, 76408643, 73656463, 17630291, 79392731, 984300, 23873535, 24028651, 32609483, 49369439, 13416151, 38184461, 8736574, 5647646, 88751199, 52406651, 53730366, 90367611, 98332405, 67478056, 22381341, 66874563, 16161282, 32121689, 35376388, 28453799, 64766364, 28086831, 97719521, 86430466, 51103084, 47208908, 52591737, 81845839, 62771854, 45074110, 22619863, 49483457, 69823762, 85271500, 75826720, 28595880, 49833101, 64406508, 46285358, 65771834, 15709554, 58767334, 3542408, 50876893, 69091011, 22815033, 60642689, 54159346, 3245161, 14485689, 77910821, 42773238, 30773397],
    'test_seed': 90859052,
    'train_dataset': {
        'class': SingleTemporalPCRDataset,
        'args': {
            'data_root': './data/datasets/soft_links/ivision-pcr-data',
            'cache_filepath': './data/datasets/soft_links/ivision-pcr-data/../single_temporal_pcr_cache.json',
            'split': 'train',
            'dataset_size': 5000,
            'rotation_mag': 45.0,
            'translation_mag': 0.5,
            'matching_radius': 0.05,
            'overlap_range': (0.0, 1.0),
            'min_points': 512,
            'transforms_cfg': {
                'class': Compose,
                'args': {
                    'transforms': [{
    'op': {
        'class': Clamp,
        'args': {
            'max_points': 8192,
        },
    },
    'input_names': [('inputs', 'src_pc'), ('inputs', 'tgt_pc')],
}],
                },
            },
            'overlap': 0.4,
        },
    },
    'train_dataloader': {
        'class': GeoTransformerDataloader,
        'args': {
            'batch_size': 1,
            'num_workers': 4,
            'num_stages': 4,
            'voxel_size': 0.1,
            'search_radius': 0.25,
        },
    },
    'criterion': {
        'class': GeoTransformerCriterion,
        'args': {
            'loss': {
                'weight_coarse_loss': 1.0,
                'weight_fine_loss': 1.0,
            },
            'coarse_loss': {
                'positive_margin': 0.1,
                'negative_margin': 1.4,
                'positive_optimal': 0.1,
                'negative_optimal': 1.4,
                'log_scale': 24,
                'positive_overlap': 0.1,
            },
            'fine_loss': {
                'positive_radius': 0.05,
            },
        },
    },
    'val_dataset': {
        'class': SingleTemporalPCRDataset,
        'args': {
            'data_root': './data/datasets/soft_links/ivision-pcr-data',
            'cache_filepath': './data/datasets/soft_links/ivision-pcr-data/../single_temporal_pcr_cache.json',
            'split': 'val',
            'dataset_size': 1000,
            'rotation_mag': 45.0,
            'translation_mag': 0.5,
            'matching_radius': 0.05,
            'overlap_range': (0.0, 1.0),
            'min_points': 512,
            'transforms_cfg': {
                'class': Compose,
                'args': {
                    'transforms': [{
    'op': {
        'class': Clamp,
        'args': {
            'max_points': 8192,
        },
    },
    'input_names': [('inputs', 'src_pc'), ('inputs', 'tgt_pc')],
}],
                },
            },
            'overlap': 0.4,
        },
    },
    'val_dataloader': {
        'class': GeoTransformerDataloader,
        'args': {
            'batch_size': 1,
            'num_workers': 4,
            'num_stages': 4,
            'voxel_size': 0.1,
            'search_radius': 0.25,
        },
    },
    'test_dataset': None,
    'test_dataloader': None,
    'metric': {
        'class': GeoTransformerMetric,
        'args': {
            'acceptance_overlap': 0.0,
            'acceptance_radius': 0.1,
            'inlier_ratio_threshold': 0.05,
            'rmse_threshold': 0.2,
            'rre_threshold': 15.0,
            'rte_threshold': 0.3,
        },
    },
    'model': {
        'class': GeoTransformer,
        'args': {
            'model': {
                'ground_truth_matching_radius': 0.05,
                'num_points_in_patch': 32,
                'num_sinkhorn_iterations': 100,
            },
            'backbone': {
                'num_stages': 4,
                'init_voxel_size': 0.025,
                'kernel_size': 15,
                'base_radius': 2.5,
                'base_sigma': 2.0,
                'init_radius': 0.0625,
                'init_sigma': 0.05,
                'group_norm': 32,
                'input_dim': 1,
                'init_dim': 64,
                'output_dim': 256,
            },
            'geotransformer': {
                'input_dim': 1024,
                'hidden_dim': 256,
                'output_dim': 256,
                'num_heads': 4,
                'blocks': ['self', 'cross', 'self', 'cross', 'self', 'cross'],
                'sigma_d': 0.2,
                'sigma_a': 15,
                'angle_k': 3,
                'reduction_a': 'max',
            },
            'coarse_matching': {
                'num_targets': 128,
                'overlap_threshold': 0.1,
                'num_correspondences': 256,
                'dual_normalization': True,
            },
            'fine_matching': {
                'topk': 3,
                'acceptance_radius': 0.1,
                'mutual': True,
                'confidence_threshold': 0.05,
                'use_dustbin': False,
                'use_global_score': False,
                'correspondence_threshold': 3,
                'correspondence_limit': None,
                'num_refinement_steps': 5,
            },
        },
    },
    'optimizer': {
        'class': SingleTaskOptimizer,
        'args': {
            'optimizer_config': {
                'class': Adam,
                'args': {
                    'params': None,
                    'lr': 0.0001,
                    'weight_decay': 1e-06,
                },
            },
        },
    },
    'scheduler': {
        'class': StepLR,
        'args': {
            'optimizer': None,
            'step_size': 1000,
            'gamma': 0.95,
        },
    },
}
