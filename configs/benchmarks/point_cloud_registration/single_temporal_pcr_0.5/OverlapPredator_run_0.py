# This file is automatically generated by `./configs/benchmarks/point_cloud_registration/gen.py`.
# Please do not attempt to modify manually.
from torch.optim.adam import Adam
from torch.optim.lr_scheduler import StepLR
from criteria.vision_3d.point_cloud_registration.overlappredator_criterion.overlappredator_criterion import OverlapPredatorCriterion
from data.dataloaders.overlappredator_dataloader import OverlapPredatorDataloader
from data.datasets.pcr_datasets.single_temporal_pcr_dataset import SingleTemporalPCRDataset
from data.transforms.compose import Compose
from data.transforms.vision_3d.clamp import Clamp
from metrics.vision_3d.point_cloud_registration.overlappredator_metric.overlappredator_metric import OverlapPredatorMetric
from models.point_cloud_registration.overlappredator.overlappredator import OverlapPredator
from optimizers.single_task_optimizer import SingleTaskOptimizer
from runners.supervised_single_task_trainer import SupervisedSingleTaskTrainer


config = {
    'runner': SupervisedSingleTaskTrainer,
    'work_dir': './logs/benchmarks/point_cloud_registration/single_temporal_pcr_0.5/OverlapPredator_run_0',
    'epochs': 100,
    'init_seed': 81571543,
    'train_seeds': [66231582, 28319799, 48958291, 12300082, 77245885, 90848318, 21393572, 12766208, 27269921, 51991132, 68565802, 41898422, 98358440, 3319444, 86360822, 92959790, 85808850, 25787038, 81252904, 7493649, 65895951, 42861911, 91640344, 82748370, 2740879, 17339020, 65093371, 44211410, 34878699, 85367076, 25231724, 26448396, 6321108, 83942933, 20417029, 81990922, 79330144, 35949344, 77419592, 21314012, 13266005, 23229719, 15754095, 44464563, 73808972, 26222912, 5246977, 43719638, 80457823, 94039041, 23007669, 75576420, 64545232, 19813971, 59428914, 36223684, 98814421, 25115311, 62283986, 52005015, 47400342, 24970737, 19450207, 53033926, 84860646, 74869180, 36630202, 72007938, 48670401, 43648491, 45013846, 19195737, 37860580, 79262127, 48123608, 61794618, 65174624, 32399926, 74368539, 71744909, 31773682, 99112755, 79748492, 56088931, 61806676, 23210826, 67353329, 8222191, 5300485, 90822366, 5967226, 73035158, 96604346, 87468520, 61245250, 54184438, 13732929, 44225712, 49852705, 23255037],
    'val_seeds': [86257202, 3149743, 3624723, 28333165, 58775438, 26327279, 16567861, 53373011, 31203984, 8875005, 54132845, 2392381, 42161130, 2114526, 94309047, 34496717, 75993341, 79153180, 56906612, 66250777, 28908694, 19467076, 94590078, 69667796, 67757359, 57147455, 98771839, 25896593, 43403037, 14793245, 83102875, 43234399, 50024181, 54277403, 70408109, 16989563, 62710144, 94734176, 12616401, 39602586, 49513910, 54629834, 94098793, 50491502, 172575, 85148972, 80928616, 83377769, 51076034, 35053378, 69665164, 63678118, 59082145, 72078075, 81683872, 85251353, 81019055, 25812932, 18582875, 88444016, 86413644, 4584558, 92389872, 23864698, 31675988, 97780024, 83101458, 39793854, 44789701, 28878097, 80220950, 10640723, 59230369, 53532997, 46439505, 23744457, 76443852, 74351364, 68519897, 4958384, 19396390, 24281563, 62023854, 4242172, 93850242, 26379352, 17960832, 68545122, 96452952, 92072272, 31904373, 97316956, 77564383, 14572852, 93273248, 60465420, 31938532, 50494738, 56757011, 6015790],
    'test_seed': 81797203,
    'train_dataset': {
        'class': SingleTemporalPCRDataset,
        'args': {
            'data_root': './data/datasets/soft_links/ivision-pcr-data',
            'cache_filepath': './data/datasets/soft_links/ivision-pcr-data/../single_temporal_pcr_cache.json',
            'split': 'train',
            'dataset_size': 5000,
            'rotation_mag': 45.0,
            'translation_mag': 0.5,
            'matching_radius': 0.05,
            'overlap_range': (0.0, 1.0),
            'min_points': 512,
            'transforms_cfg': {
                'class': Compose,
                'args': {
                    'transforms': [{
    'op': {
        'class': Clamp,
        'args': {
            'max_points': 8192,
        },
    },
    'input_names': [('inputs', 'src_pc'), ('inputs', 'tgt_pc')],
}],
                },
            },
            'overlap': 0.5,
        },
    },
    'train_dataloader': {
        'class': OverlapPredatorDataloader,
        'args': {
            'batch_size': 1,
            'num_workers': 4,
            'config': {
                'deform_radius': 5.0,
                'num_layers': 4,
                'first_subsampling_dl': 0.3,
                'conv_radius': 4.25,
                'architecture': ['simple', 'resnetb', 'resnetb_strided', 'resnetb', 'resnetb', 'resnetb_strided', 'resnetb', 'resnetb', 'resnetb_strided', 'resnetb', 'resnetb', 'nearest_upsample', 'unary', 'nearest_upsample', 'unary', 'nearest_upsample', 'last_unary'],
            },
        },
    },
    'criterion': {
        'class': OverlapPredatorCriterion,
        'args': {
            'log_scale': 48,
            'pos_optimal': 0.1,
            'neg_optimal': 1.4,
            'pos_margin': 0.1,
            'neg_margin': 1.4,
            'max_points': 512,
            'safe_radius': 0.75,
            'matchability_radius': 0.3,
            'pos_radius': 0.21,
            'w_circle_loss': 1.0,
            'w_overlap_loss': 1.0,
            'w_saliency_loss': 0.0,
        },
    },
    'val_dataset': {
        'class': SingleTemporalPCRDataset,
        'args': {
            'data_root': './data/datasets/soft_links/ivision-pcr-data',
            'cache_filepath': './data/datasets/soft_links/ivision-pcr-data/../single_temporal_pcr_cache.json',
            'split': 'val',
            'dataset_size': 1000,
            'rotation_mag': 45.0,
            'translation_mag': 0.5,
            'matching_radius': 0.05,
            'overlap_range': (0.0, 1.0),
            'min_points': 512,
            'transforms_cfg': {
                'class': Compose,
                'args': {
                    'transforms': [{
    'op': {
        'class': Clamp,
        'args': {
            'max_points': 8192,
        },
    },
    'input_names': [('inputs', 'src_pc'), ('inputs', 'tgt_pc')],
}],
                },
            },
            'overlap': 0.5,
        },
    },
    'val_dataloader': {
        'class': OverlapPredatorDataloader,
        'args': {
            'batch_size': 1,
            'num_workers': 4,
            'config': {
                'deform_radius': 5.0,
                'num_layers': 4,
                'first_subsampling_dl': 0.3,
                'conv_radius': 4.25,
                'architecture': ['simple', 'resnetb', 'resnetb_strided', 'resnetb', 'resnetb', 'resnetb_strided', 'resnetb', 'resnetb', 'resnetb_strided', 'resnetb', 'resnetb', 'nearest_upsample', 'unary', 'nearest_upsample', 'unary', 'nearest_upsample', 'last_unary'],
            },
        },
    },
    'test_dataset': None,
    'test_dataloader': None,
    'metric': {
        'class': OverlapPredatorMetric,
        'args': {
            'max_points': 512,
            'matchability_radius': 0.3,
            'pos_radius': 0.21,
        },
    },
    'model': {
        'class': OverlapPredator,
        'args': {
            'architecture': ['simple', 'resnetb', 'resnetb_strided', 'resnetb', 'resnetb', 'resnetb_strided', 'resnetb', 'resnetb', 'resnetb_strided', 'resnetb', 'resnetb', 'nearest_upsample', 'unary', 'nearest_upsample', 'unary', 'nearest_upsample', 'last_unary'],
            'num_layers': 4,
            'in_points_dim': 3,
            'first_feats_dim': 256,
            'final_feats_dim': 32,
            'first_subsampling_dl': 0.3,
            'in_feats_dim': 1,
            'conv_radius': 4.25,
            'deform_radius': 5.0,
            'num_kernel_points': 15,
            'KP_extent': 2.0,
            'KP_influence': 'linear',
            'aggregation_mode': 'sum',
            'fixed_kernel_points': 'center',
            'use_batch_norm': True,
            'batch_norm_momentum': 0.02,
            'deformable': False,
            'modulated': False,
            'add_cross_score': True,
            'condition_feature': True,
            'gnn_feats_dim': 256,
            'dgcnn_k': 10,
            'num_head': 4,
            'nets': ['self', 'cross', 'self'],
        },
    },
    'optimizer': {
        'class': SingleTaskOptimizer,
        'args': {
            'optimizer_config': {
                'class': Adam,
                'args': {
                    'params': None,
                    'lr': 0.0001,
                    'weight_decay': 1e-06,
                },
            },
        },
    },
    'scheduler': {
        'class': StepLR,
        'args': {
            'optimizer': None,
            'step_size': 1000,
            'gamma': 0.95,
        },
    },
}
