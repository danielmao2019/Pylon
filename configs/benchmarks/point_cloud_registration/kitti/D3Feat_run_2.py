# This file is automatically generated by `./configs/benchmarks/point_cloud_registration/gen.py`.
# Please do not attempt to modify manually.
from torch.optim.adam import Adam
from torch.optim.lr_scheduler import StepLR
from torch.utils.data.dataloader import DataLoader
from criteria.vision_3d.point_cloud_registration.d3feat_criteria.d3feat_criterion import CircleLoss
from data.datasets.pcr_datasets.threedmatch_dataset import ThreeDMatchDataset
from data.transforms.compose import Compose
from data.transforms.vision_3d.gaussian_pos_noise import GaussianPosNoise
from data.transforms.vision_3d.random_rigid_transform import RandomRigidTransform
from metrics.vision_3d.point_cloud_registration.d3feat_metrics.d3feat_metric import D3FeatDescriptorMetric
from models.point_cloud_registration.d3feat.d3feat_model import D3FeatModel
from optimizers.single_task_optimizer import SingleTaskOptimizer
from runners.supervised_single_task_trainer import SupervisedSingleTaskTrainer
from utils.point_cloud_ops.random_select import RandomSelect


config = {
    'runner': SupervisedSingleTaskTrainer,
    'work_dir': './logs/benchmarks/point_cloud_registration/kitti/D3Feat_run_2',
    'epochs': 100,
    'init_seed': 65761505,
    'train_seeds': [87009809, 56111182, 10442002, 1111166, 84303021, 425920, 63133532, 52093191, 25964273, 3275193, 46284652, 50344357, 19042420, 36613880, 67401150, 92056879, 95487025, 31167637, 67532707, 36716538, 50978990, 70632606, 51417138, 18349749, 36705037, 63599473, 91417466, 38477120, 49206905, 43280659, 44243872, 38892743, 57457883, 34358172, 41717334, 90039618, 85220100, 32039686, 89038278, 67930833, 4930222, 25020563, 92510953, 97511312, 66491148, 15096140, 3475714, 36104028, 3698502, 46742694, 61850233, 87311853, 22082893, 43019185, 88084695, 78075002, 8867620, 61653865, 32233241, 667864, 75654855, 50621386, 84984611, 49679062, 82889407, 68168731, 13325547, 28589545, 3820309, 5686379, 19996456, 54844333, 38258638, 67237128, 55551605, 75485788, 87465584, 37337859, 4827791, 67457405, 37855442, 7354776, 54486541, 85853865, 57665274, 89405563, 62653273, 52607005, 19341306, 92669435, 23901578, 68335622, 80920238, 95478678, 65927248, 81851741, 83554793, 13879248, 90739334, 28183292],
    'val_seeds': [73723784, 15757425, 72173534, 26171354, 1742282, 99070568, 15530449, 89997405, 95285596, 69819164, 61093939, 31897297, 50322336, 10592213, 87153067, 85744217, 674919, 64469503, 45772092, 9453083, 33584467, 90549730, 66499502, 76939288, 45016311, 54002415, 93677285, 68348243, 13234491, 22415943, 41624925, 95077627, 27860568, 71981299, 44795012, 51791592, 61045725, 97700195, 23611189, 85941358, 25053648, 44594492, 37292824, 78191297, 49254497, 98281693, 32527031, 96905921, 59867212, 23425944, 3538313, 99689552, 45335013, 58411624, 87006404, 52522645, 94377611, 46200998, 94757972, 34158658, 8585493, 9977997, 62741187, 5084307, 47556886, 28583900, 95833240, 45884995, 29598415, 77362918, 89201330, 36917397, 78001505, 42198324, 10269054, 66082114, 82752782, 16715448, 31040998, 48271032, 26714054, 45930560, 62671772, 21745750, 85360086, 52029079, 48214051, 63706483, 74704782, 47779883, 33289270, 56797419, 16779823, 62772596, 90690516, 63951367, 16826935, 49488589, 10573733, 74185059],
    'test_seed': 47463006,
    'train_dataset': {
        'class': ThreeDMatchDataset,
        'args': {
            'data_root': './data/datasets/soft_links/threedmatch',
            'split': 'train',
            'matching_radius': 0.1,
            'transforms_cfg': {
                'class': Compose,
                'args': {
                    'transforms': [(
    {
            'class': RandomSelect,
            'args': {
                'count': 5000,
            },
        },
    [('inputs', 'src_pc')]
), (
    {
            'class': RandomSelect,
            'args': {
                'count': 5000,
            },
        },
    [('inputs', 'tgt_pc')]
), (
    {
            'class': RandomRigidTransform,
            'args': {
                'rot_mag': 45.0,
                'trans_mag': 0.5,
                'method': 'Rodrigues',
            },
        },
    [('inputs', 'src_pc'), ('inputs', 'tgt_pc'), ('labels', 'transform')]
), (
    {
            'class': GaussianPosNoise,
            'args': {
                'std': 0.01,
            },
        },
    [('inputs', 'src_pc')]
), (
    {
            'class': GaussianPosNoise,
            'args': {
                'std': 0.01,
            },
        },
    [('inputs', 'tgt_pc')]
)],
                },
            },
        },
    },
    'train_dataloader': {
        'class': DataLoader,
        'args': {
            'batch_size': 1,
            'num_workers': 4,
            'shuffle': True,
        },
    },
    'criterion': {
        'class': CircleLoss,
        'args': {
            'pos_margin': 0.1,
            'neg_margin': 1.4,
            'pos_optimal': 0.1,
            'neg_optimal': 1.4,
            'log_scale': 10.0,
            'safe_radius': 0.04,
            'use_buffer': True,
        },
    },
    'val_dataset': {
        'class': ThreeDMatchDataset,
        'args': {
            'data_root': './data/datasets/soft_links/threedmatch',
            'split': 'val',
            'matching_radius': 0.1,
            'transforms_cfg': {
                'class': Compose,
                'args': {
                    'transforms': [(
    {
            'class': RandomSelect,
            'args': {
                'count': 5000,
            },
        },
    [('inputs', 'src_pc')]
), (
    {
            'class': RandomSelect,
            'args': {
                'count': 5000,
            },
        },
    [('inputs', 'tgt_pc')]
)],
                },
            },
        },
    },
    'val_dataloader': {
        'class': DataLoader,
        'args': {
            'batch_size': 1,
            'num_workers': 4,
            'shuffle': False,
        },
    },
    'test_dataset': None,
    'test_dataloader': None,
    'metric': {
        'class': D3FeatDescriptorMetric,
        'args': {
            'distance_threshold': 0.1,
            'use_buffer': True,
        },
    },
    'model': {
        'class': D3FeatModel,
        'args': {
            'num_layers': 5,
            'in_points_dim': 3,
            'first_features_dim': 128,
            'first_subsampling_dl': 0.03,
            'in_features_dim': 1,
            'conv_radius': 2.5,
            'deform_radius': 5.0,
            'num_kernel_points': 15,
            'KP_extent': 2.0,
            'KP_influence': 'linear',
            'aggregation_mode': 'sum',
            'fixed_kernel_points': 'center',
            'use_batch_norm': False,
            'batch_norm_momentum': 0.02,
            'deformable': False,
            'modulated': False,
        },
    },
    'optimizer': {
        'class': SingleTaskOptimizer,
        'args': {
            'optimizer_config': {
                'class': Adam,
                'args': {
                    'params': None,
                    'lr': 0.0001,
                    'weight_decay': 1e-06,
                },
            },
        },
    },
    'scheduler': {
        'class': StepLR,
        'args': {
            'optimizer': None,
            'step_size': 1000,
            'gamma': 0.95,
        },
    },
}
