# This file is automatically generated by `./configs/benchmarks/point_cloud_registration/gen.py`.
# Please do not attempt to modify manually.
from torch.optim.adam import Adam
from torch.optim.lr_scheduler import StepLR
from criteria.vision_3d.point_cloud_registration.overlappredator_criterion.overlappredator_criterion import OverlapPredatorCriterion
from data.dataloaders.overlappredator_dataloader import OverlapPredatorDataloader
from data.datasets.pcr_datasets.single_temporal_pcr_dataset import SingleTemporalPCRDataset
from data.transforms.compose import Compose
from data.transforms.vision_3d.clamp import Clamp
from metrics.vision_3d.point_cloud_registration.overlappredator_metric.overlappredator_metric import OverlapPredatorMetric
from models.point_cloud_registration.overlappredator.overlappredator import OverlapPredator
from optimizers.single_task_optimizer import SingleTaskOptimizer
from runners.supervised_single_task_trainer import SupervisedSingleTaskTrainer


config = {
    'runner': SupervisedSingleTaskTrainer,
    'work_dir': './logs/benchmarks/point_cloud_registration/single_temporal_pcr_1.0/OverlapPredator_run_2',
    'epochs': 100,
    'init_seed': 63156138,
    'train_seeds': [61155990, 79123852, 25044043, 41763133, 33126713, 55190505, 83028693, 32536057, 51391901, 45444429, 68738006, 1147941, 38651361, 74338142, 25166929, 96365576, 45861538, 29121806, 25376494, 49699592, 67451519, 34404252, 72831776, 96584013, 3052690, 42354566, 14571957, 93097100, 62075539, 8946293, 1863658, 70270799, 82485284, 56153859, 72033397, 36600791, 31034216, 21264488, 84790993, 28764529, 74155667, 15329671, 16712785, 68974802, 9911760, 35369777, 17819744, 76020996, 85757889, 15174575, 23931251, 39206971, 56145414, 18917871, 15818418, 66584786, 75226306, 71973495, 24609718, 85726763, 51560267, 11741611, 50404040, 92531764, 82459311, 65261675, 87034218, 86306755, 95282294, 49956439, 74405489, 3486623, 92402802, 85430543, 93316564, 30178067, 8501853, 15892079, 88402400, 14960665, 41609815, 89575222, 34618969, 33517310, 66931677, 90902372, 78030947, 28424569, 98993497, 50601883, 60982910, 34846970, 20911779, 28988041, 17254134, 43467428, 93055296, 3984896, 26430128, 40576183],
    'val_seeds': [78273326, 32143143, 74629529, 78527694, 58294283, 19261183, 95272249, 48118886, 58574904, 58934559, 35985322, 98618099, 30510247, 78218820, 28711634, 16894113, 24114817, 10861265, 59226294, 69771123, 57781092, 1991034, 11497273, 88817169, 66339645, 5045070, 52821495, 91444489, 38513235, 89683743, 71063161, 60784837, 19067536, 57889295, 69627638, 11401082, 24910627, 90661561, 88732980, 37470840, 53699939, 43091628, 82079570, 11253661, 98207576, 84376648, 82519148, 15969947, 60715863, 53273912, 36853518, 63866290, 8293379, 17896818, 97967554, 28799803, 44234307, 97530721, 83622833, 54818901, 91392992, 58245127, 36671654, 1430083, 60264335, 7410122, 70234190, 7980472, 49169216, 37518285, 16482263, 1345644, 37619749, 50339373, 1601378, 83761932, 64982682, 98760781, 25721898, 83267416, 97084169, 72208435, 31484517, 5988618, 84215255, 40335419, 42768709, 28749726, 62426662, 63245598, 22163581, 65437863, 8789960, 73379267, 94548735, 57158150, 49484692, 12170183, 35166613, 12880237],
    'test_seed': 30427393,
    'train_dataset': {
        'class': SingleTemporalPCRDataset,
        'args': {
            'data_root': './data/datasets/soft_links/ivision-pcr-data',
            'cache_filepath': './data/datasets/soft_links/ivision-pcr-data/../single_temporal_pcr_cache.json',
            'split': 'train',
            'dataset_size': 5000,
            'rotation_mag': 45.0,
            'translation_mag': 0.5,
            'matching_radius': 0.05,
            'overlap_range': (0.0, 1.0),
            'min_points': 512,
            'transforms_cfg': {
                'class': Compose,
                'args': {
                    'transforms': [{
    'op': {
        'class': Clamp,
        'args': {
            'max_points': 8192,
        },
    },
    'input_names': [('inputs', 'src_pc'), ('inputs', 'tgt_pc')],
}],
                },
            },
            'overlap': 1.0,
        },
    },
    'train_dataloader': {
        'class': OverlapPredatorDataloader,
        'args': {
            'batch_size': 1,
            'num_workers': 4,
            'config': {
                'deform_radius': 5.0,
                'num_layers': 4,
                'first_subsampling_dl': 0.3,
                'conv_radius': 4.25,
                'architecture': ['simple', 'resnetb', 'resnetb_strided', 'resnetb', 'resnetb', 'resnetb_strided', 'resnetb', 'resnetb', 'resnetb_strided', 'resnetb', 'resnetb', 'nearest_upsample', 'unary', 'nearest_upsample', 'unary', 'nearest_upsample', 'last_unary'],
            },
        },
    },
    'criterion': {
        'class': OverlapPredatorCriterion,
        'args': {
            'log_scale': 48,
            'pos_optimal': 0.1,
            'neg_optimal': 1.4,
            'pos_margin': 0.1,
            'neg_margin': 1.4,
            'max_points': 512,
            'safe_radius': 0.75,
            'matchability_radius': 0.3,
            'pos_radius': 0.21,
            'w_circle_loss': 1.0,
            'w_overlap_loss': 1.0,
            'w_saliency_loss': 0.0,
        },
    },
    'val_dataset': {
        'class': SingleTemporalPCRDataset,
        'args': {
            'data_root': './data/datasets/soft_links/ivision-pcr-data',
            'cache_filepath': './data/datasets/soft_links/ivision-pcr-data/../single_temporal_pcr_cache.json',
            'split': 'val',
            'dataset_size': 1000,
            'rotation_mag': 45.0,
            'translation_mag': 0.5,
            'matching_radius': 0.05,
            'overlap_range': (0.0, 1.0),
            'min_points': 512,
            'transforms_cfg': {
                'class': Compose,
                'args': {
                    'transforms': [{
    'op': {
        'class': Clamp,
        'args': {
            'max_points': 8192,
        },
    },
    'input_names': [('inputs', 'src_pc'), ('inputs', 'tgt_pc')],
}],
                },
            },
            'overlap': 1.0,
        },
    },
    'val_dataloader': {
        'class': OverlapPredatorDataloader,
        'args': {
            'batch_size': 1,
            'num_workers': 4,
            'config': {
                'deform_radius': 5.0,
                'num_layers': 4,
                'first_subsampling_dl': 0.3,
                'conv_radius': 4.25,
                'architecture': ['simple', 'resnetb', 'resnetb_strided', 'resnetb', 'resnetb', 'resnetb_strided', 'resnetb', 'resnetb', 'resnetb_strided', 'resnetb', 'resnetb', 'nearest_upsample', 'unary', 'nearest_upsample', 'unary', 'nearest_upsample', 'last_unary'],
            },
        },
    },
    'test_dataset': None,
    'test_dataloader': None,
    'metric': {
        'class': OverlapPredatorMetric,
        'args': {
            'max_points': 512,
            'matchability_radius': 0.3,
            'pos_radius': 0.21,
        },
    },
    'model': {
        'class': OverlapPredator,
        'args': {
            'architecture': ['simple', 'resnetb', 'resnetb_strided', 'resnetb', 'resnetb', 'resnetb_strided', 'resnetb', 'resnetb', 'resnetb_strided', 'resnetb', 'resnetb', 'nearest_upsample', 'unary', 'nearest_upsample', 'unary', 'nearest_upsample', 'last_unary'],
            'num_layers': 4,
            'in_points_dim': 3,
            'first_feats_dim': 256,
            'final_feats_dim': 32,
            'first_subsampling_dl': 0.3,
            'in_feats_dim': 1,
            'conv_radius': 4.25,
            'deform_radius': 5.0,
            'num_kernel_points': 15,
            'KP_extent': 2.0,
            'KP_influence': 'linear',
            'aggregation_mode': 'sum',
            'fixed_kernel_points': 'center',
            'use_batch_norm': True,
            'batch_norm_momentum': 0.02,
            'deformable': False,
            'modulated': False,
            'add_cross_score': True,
            'condition_feature': True,
            'gnn_feats_dim': 256,
            'dgcnn_k': 10,
            'num_head': 4,
            'nets': ['self', 'cross', 'self'],
        },
    },
    'optimizer': {
        'class': SingleTaskOptimizer,
        'args': {
            'optimizer_config': {
                'class': Adam,
                'args': {
                    'params': None,
                    'lr': 0.0001,
                    'weight_decay': 1e-06,
                },
            },
        },
    },
    'scheduler': {
        'class': StepLR,
        'args': {
            'optimizer': None,
            'step_size': 1000,
            'gamma': 0.95,
        },
    },
}
